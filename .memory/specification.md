# テトリスライクゲーム仕様書

## 1. ゲーム概要

このプロジェクトは、TypeScriptとReactを使用して構築されたテトリスライクなブロック落下パズルゲームです。プレイヤーは様々な形のブロックを操作し、水平なラインを完成させることでスコアを獲得します。

## 2. ゲームルール

- 様々な形のブロック（テトロミノ）が画面上部から落下します
- プレイヤーはブロックを左右に移動、回転、または素早く落下させることができます
- ブロックが水平ラインを完全に埋めると、そのラインは消去され、スコアが加算されます
- ブロックが画面上部に積み上がり、新しいブロックが出現できなくなるとゲームオーバーとなります

## 3. ゲーム機能

- ブロックの移動：左右の矢印キーでブロックを水平移動
- ブロックの回転：上矢印キーでブロックを時計回りに回転
- ブロックの高速落下：下矢印キーでブロックを素早く落下
- スコア表示：消去したライン数とスコアを表示
- レベル：一定のスコアに達すると難易度（落下速度）が上昇
- 次のブロックプレビュー：次に出現するブロックを表示
- ゲームの一時停止と再開
- ゲームオーバー表示とリスタート機能

## 4. コンポーネント構造

実際の実装では、以下のコンポーネント構造を採用しています：

```
App
├── GameBoard（ゲームボードの表示）
├── InfoPanel（スコア、レベル、次のブロック表示）
└── Controls（ゲーム操作ボタン）
```

### 4.1 ファイル構造

```
/src
├── components/
│   ├── GameBoard.tsx（ゲームボードコンポーネント）
│   ├── InfoPanel.tsx（情報パネルコンポーネント）
│   └── Controls.tsx（コントロールコンポーネント）
├── hooks/
│   └── useGameLogic.ts（ゲームロジックのカスタムフック）
├── types.ts（型定義）
├── utils.ts（ユーティリティ関数）
├── App.tsx（メインコンポーネント）
├── App.css（スタイル定義）
├── index.css（グローバルスタイル）
└── main.tsx（エントリーポイント）
```

## 5. データモデル

### 5.1 ゲーム状態

```typescript
interface GameState {
  grid: number[][];        // ゲームボードの状態（0: 空, 1-7: ブロックの種類）
  currentBlock: Block;     // 現在操作中のブロック
  nextBlock: Block;        // 次に出現するブロック
  score: number;           // 現在のスコア
  level: number;           // 現在のレベル
  lines: number;           // 消去したライン数
  isGameOver: boolean;     // ゲームオーバー状態
  isPaused: boolean;       // 一時停止状態
}
```

### 5.2 ブロックモデル

```typescript
interface Block {
  shape: number[][];       // ブロックの形状（2次元配列）
  position: {              // ブロックの現在位置
    x: number;
    y: number;
  };
  type: number;            // ブロックの種類（1-7）
}
```

### 5.3 ブロックの種類

7種類の標準的なテトロミノを実装します：
- I型（水色）：4つのブロックが直線状に並ぶ
- J型（青色）：3つのブロックが直線状に並び、残り1つが端に接続
- L型（オレンジ色）：3つのブロックが直線状に並び、残り1つが反対側の端に接続
- O型（黄色）：2x2の正方形
- S型（緑色）：ジグザグ形状（S字型）
- T型（紫色）：3つのブロックが直線状に並び、残り1つが中央に接続
- Z型（赤色）：ジグザグ形状（Z字型）

## 6. ゲームロジック

### 6.1 メインゲームループ

- 一定間隔でブロックを1マス下に移動
- ブロックが他のブロックまたは底に接触したら固定
- 固定後、水平ラインが完成しているか確認
- 完成したラインを消去し、スコアを加算
- 新しいブロックを生成
- ゲームオーバー条件を確認

### 6.2 衝突検出

- ブロックの移動や回転時に、壁や他のブロックとの衝突を検出
- 衝突が検出された場合、その移動や回転を無効化

### 6.3 スコア計算

- 1ライン消去：100点 × 現在のレベル
- 2ライン同時消去：300点 × 現在のレベル
- 3ライン同時消去：500点 × 現在のレベル
- 4ライン同時消去：800点 × 現在のレベル

### 6.4 レベル進行

- 10ライン消去ごとにレベルアップ
- レベルが上がるごとにブロックの落下速度が増加

## 7. 技術仕様

- フロントエンド：React + TypeScript
- 開発環境：Vite（高速な開発サーバーと最適化されたビルド）
- スタイリング：CSS（CSS変数を活用したテーマ設定）
- 状態管理：React Hooks（useReducer, useEffect, useCallback）
- キーボード入力処理：イベントリスナー（window.addEventListener）
- アニメーション：CSS transitions
- レスポンシブデザイン：メディアクエリによる画面サイズ対応

### 7.1 実装の詳細

#### 状態管理
- `useGameLogic` カスタムフックでゲームの状態とロジックを管理
- Reducerパターンを使用して、ゲームの状態更新を一元管理
- 非同期処理（ブロックの自動落下）はuseEffectで実装

#### キー操作
- 矢印キー：ブロックの移動と回転
- スペースキー：ハードドロップ（即時落下）
- Pキー：一時停止/再開
- Rキー：ゲームリスタート

#### UI設計
- ダークテーマをベースにした視認性の高いUI
- 各テトロミノに固有の色を割り当て
- 次のブロックプレビューで先読み可能
- スコア、レベル、ライン数の常時表示

## 8. 将来の拡張可能性

- ハイスコア保存機能
- 複数の難易度レベル
- カスタムテーマ
- モバイル対応（タッチコントロール）
- マルチプレイヤーモード
